var e=Object.defineProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,o=(e,o)=>{for(var r in o||(o={}))s.call(o,r)&&i(e,r,o[r]);if(t)for(var r of t(o))n.call(o,r)&&i(e,r,o[r]);return e},r=(e,t,s)=>(i(e,"symbol"!=typeof t?t+"":t,s),s);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class l{constructor(e=0,t=0){r(this,"x"),r(this,"y"),this.x=e,this.y=t}equals(e){return this.x===e.x&&this.y===e.y}move(e){return new l(this.x+e.x,this.y+e.y)}rotate(e){const t=e/180*Math.PI,s=Math.cos(t),n=Math.sin(t),i=this.x*s-this.y*n,o=this.x*n+this.y*s;return new l(i,o)}scale(e){return new l(this.x*e,this.y*e)}}class a{constructor(e){var t,s,n,i;r(this,"anchor"),r(this,"scroll"),r(this,"scale"),r(this,"angle"),this.anchor=null!=(t=null==e?void 0:e.anchor)?t:new l,this.scroll=null!=(s=null==e?void 0:e.scroll)?s:new l,this.scale=null!=(n=null==e?void 0:e.scale)?n:1,this.angle=null!=(i=null==e?void 0:e.angle)?i:0}toData(){return{anchor:this.anchor,scroll:this.scroll,scale:this.scale,angle:this.angle}}clone(e){const t=this.toData();return new a(o(o({},t),e))}}class h{constructor(e,t=0,s=1){r(this,"ctx"),r(this,"outWidth"),r(this,"outHeight"),r(this,"position",new l),r(this,"_coord"),r(this,"children",[]),r(this,"color","#000000"),r(this,"lineWidth",10),r(this,"isDrawSelf",!0),this.ctx=e,this.outWidth=t,this.outHeight=s,this._coord=new a({anchor:new l(t/2,s/2)})}set coord(e){this._coord=this._coord.clone({scale:e.scale,scroll:e.scroll,angle:e.angle})}addChildPen(e){const t=new h(this.ctx,this.outWidth,this.outHeight);e&&(t.coord=e),this.children.push(t)}clearChildren(){this.children.length=0}applyCoord(){const e=this._coord;this.ctx.translate(-e.scroll.x,-e.scroll.y),this.ctx.translate(e.anchor.x,e.anchor.y),this.ctx.rotate(e.angle/180*Math.PI),this.ctx.scale(e.scale,e.scale),this.ctx.translate(-e.anchor.x,-e.anchor.y)}moveTo(e){this.position=e,this.children.forEach((t=>t.moveTo(e)))}drawTo(e,t=.5){this.ctx.save(),this.applyCoord(),this.isDrawSelf&&(this.ctx.lineWidth=this.lineWidth*t,this.ctx.strokeStyle=this.color,this.ctx.beginPath(),this.ctx.moveTo(this.position.x,this.position.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke()),this.children.forEach((s=>s.drawTo(e,t))),this.ctx.restore(),this.position=e}}class c{constructor(e,t){r(this,"el"),r(this,"ctx"),r(this,"width"),r(this,"height"),r(this,"_coord"),r(this,"_pen");const s=document.createElement("canvas"),n=s.getContext("2d");if(!n)throw new Error("Failed to get 2d context for canvas");this.width=e,this.height=t,s.width=e,s.height=t,s.style.border="1px solid #aaa",n.lineCap="round",this.el=s,this.ctx=n,this._coord=new a,this._pen=new h(n,e,t)}set coord(e){this._coord=e,this.ctx.resetTransform(),this.ctx.translate(-e.anchor.x,-e.anchor.y),this.ctx.scale(1/e.scale,1/e.scale),this.ctx.rotate(-e.angle/180*Math.PI),this.ctx.translate(e.anchor.x,e.anchor.y),this.ctx.translate(e.scroll.x,e.scroll.y)}get pen(){return this._pen}get coord(){return this._coord}moveTo(e){this.pen.moveTo(e)}drawTo(e,t=.5){this.pen.drawTo(e,t)}clear(){this.ctx.save(),this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.restore()}output(e,t){t.save();const s=this.coord;t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.translate(-s.scroll.x,-s.scroll.y),t.translate(-s.anchor.x,-s.anchor.y),t.rotate(s.angle/180*Math.PI),t.scale(s.scale,s.scale),t.translate(s.anchor.x,s.anchor.y),t.drawImage(this.el,0,0),t.strokeStyle="#aaaaaa",t.strokeRect(0,0,e.width,e.height),t.restore()}}class u{constructor(){r(this,"listeners",[])}fire(e){this.listeners.forEach((t=>t(e)))}listen(e){this.listeners.includes(e)||this.listeners.push(e)}}class d{constructor(e){r(this,"target"),r(this,"_keys",{}),r(this,"_removeEvents"),r(this,"onChange",new u),this.target=null!=e?e:document.body;const t=e=>{const t=e.key;this._keys[t]=!0,this.onChange.fire({key:t,isDown:!0})},s=e=>{const t=e.key;delete this._keys[t],this.onChange.fire({key:t,isDown:!1})};this.target.addEventListener("keydown",t),this.target.addEventListener("keyup",s),this._removeEvents=()=>{this.target.removeEventListener("keydown",t),this.target.removeEventListener("keyup",s)}}listen(...e){this.onChange.listen(...e)}destroy(){this._removeEvents()}key(e){return!!this._keys[e]}get keys(){return Object.keys(this._keys)}}const v=e=>{const t=e.includes(" "),s=e.includes("Alt"),n=e.includes("Meta");return t&&n&&s?"zoomdown":t&&n?"zoomup":t?"scroll":"draw"};class p{constructor(e){r(this,"el");const t=this.el=document.createElement("button");t.className="Button",t.textContent=e}addEventListener(...e){return this.el.addEventListener(...e)}removeEventListener(...e){return this.el.removeEventListener(...e)}}class g{constructor(e,t=0,s=100,n=0,i=!1){r(this,"el"),r(this,"elSlider"),r(this,"elText"),r(this,"isPercent");const o=this.el=document.createElement("div"),l=this.elSlider=document.createElement("input"),a=document.createElement("label"),h=document.createElement("span"),c=this.elText=document.createElement("span");this.isPercent=i,o.appendChild(a),a.appendChild(h),a.appendChild(c),a.appendChild(l),l.type="range",l.className="Slider",l.min=String(t),l.max=String(s),l.value=String(n),h.textContent=`${e}: `,c.textContent=l.value,l.addEventListener("input",(()=>{c.textContent=l.value}))}get value(){return this.elSlider.valueAsNumber*(this.isPercent?.01:1)}set value(e){const t=e*(this.isPercent?100:1);this.elSlider.value=String(t),this.elText.textContent=String(t)}addEventListener(...e){return this.elSlider.addEventListener(...e)}removeEventListener(...e){return this.elSlider.removeEventListener(...e)}}const w=[0,.2,.33,.5,.67,.75,1,1.5,2,2.5,3,3.5,4,1/0],m=document.querySelector("#main"),C=document.querySelector("#palette"),y=new class{constructor(e){r(this,"slScale"),r(this,"slAngle"),r(this,"slX"),r(this,"slY"),r(this,"slPenCount"),r(this,"onScaleChange",new u),r(this,"onAngleChange",new u),r(this,"onScrollChange",new u),r(this,"onPenCountChange",new u),r(this,"onClear",new u);const t=this.slScale=new g("Scale",50,300,100,!0),s=this.slAngle=new g("Angle",-180,180,0),n=this.slX=new g("Scroll X",-400,400,0),i=this.slY=new g("Scroll Y",-400,400,0),o=this.slPenCount=new g("Pen Count",1,12,1),a=new p("Clear All");e.appendChild(t.el),e.appendChild(s.el),e.appendChild(n.el),e.appendChild(i.el),e.appendChild(o.el),e.appendChild(a.el),t.addEventListener("input",(()=>{this.onScaleChange.fire(t.value)})),s.addEventListener("input",(()=>{this.onAngleChange.fire(s.value)})),n.addEventListener("input",(()=>{this.onScrollChange.fire(new l(n.value,i.value))})),i.addEventListener("input",(()=>{this.onScrollChange.fire(new l(n.value,i.value))})),o.addEventListener("input",(()=>{this.onPenCountChange.fire(o.value)})),a.addEventListener("click",(()=>{this.onClear.fire()}))}get scale(){return this.slScale.value}get angle(){return this.slAngle.value}get scroll(){return new l(this.slX.value,this.slY.value)}get penCount(){return this.slPenCount.value}set scale(e){this.scale!==e&&(this.slScale.value=e,this.onScaleChange.fire(this.slScale.value))}set angle(e){this.angle!==e&&(this.slAngle.value=e,this.onAngleChange.fire(this.slAngle.value))}set scrollX(e){this.slX.value!==e&&(this.slX.value=e,this.onScrollChange.fire(new l(this.slX.value,this.slY.value)))}set scrollY(e){this.slY.value!==e&&(this.slY.value=e,this.onScrollChange.fire(new l(this.slX.value,this.slY.value)))}set penCount(e){this.penCount!==e&&(this.slPenCount.value=e,this.onPenCountChange.fire(this.slPenCount.value))}}(C),x=new class{constructor(e){r(this,"canvas"),r(this,"view"),r(this,"keyWatcher"),r(this,"eventStatus",{isWatchMove:!1,activeEvent:void 0}),r(this,"requestChangeZoom",new u),r(this,"_penCount",1),this.canvas=new c(800,800),this.view=new c(800,800),e.appendChild(this.view.el),this.registerEventHandlers(),this.keyWatcher=new d,this.keyWatcher.listen((()=>{var e,t;this.view.el.style.cursor=(e=v(this.keyWatcher.keys),null!=(t={draw:"crosshair",scroll:"move",zoomup:"zoom-in",zoomdown:"zoom-out"}[e])?t:"default")}))}registerEventHandlers(){const e=this.view.el;e.addEventListener("pointerdown",(e=>this.onDown(e))),e.addEventListener("pointermove",(e=>this.eventStatus.isWatchMove&&this.onMove(e))),e.addEventListener("pointerup",(e=>this.eventStatus.isWatchMove&&this.onUp(e)))}get coord(){return this.canvas.coord}set coord(e){this.canvas.coord=e.clone({anchor:new l(-400,-400)}),this.canvas.output(this.view.el,this.view.ctx)}get penCount(){return this._penCount}set penCount(e){if(e===this.penCount)return;const t=this.canvas.pen;if(t.clearChildren(),!(e<=1))for(let s=1;s<e;s++)t.addChildPen(new a({angle:360*s/e}))}listenRequestZoom(...e){this.requestChangeZoom.listen(...e)}clear(){this.canvas.clear(),this.canvas.output(this.view.el,this.view.ctx)}event2canvasPoint(e){return new l(1*e.offsetX,1*e.offsetY)}onDown(e){const t=v(this.keyWatcher.keys);this.eventStatus.activeEvent=t,"draw"===t&&(this.eventStatus.isWatchMove=!0,this.moveTo(this.event2canvasPoint(e))),"zoomup"===t&&this.requestChangeZoom.fire(!0),"zoomdown"===t&&this.requestChangeZoom.fire(!1)}onMove(e){this.drawTo(this.event2canvasPoint(e),e.pressure)}onUp(e){this.eventStatus.isWatchMove=!1,this.drawTo(this.event2canvasPoint(e),e.pressure),this.eventStatus.activeEvent=void 0}moveTo(e){this.canvas.moveTo(e)}drawTo(e,t=.5){this.canvas.drawTo(e,t),this.canvas.output(this.view.el,this.view.ctx)}}(m);y.onScaleChange.listen((e=>{x.coord=x.coord.clone({scale:e})})),y.onAngleChange.listen((e=>{x.coord=x.coord.clone({angle:e})})),y.onScrollChange.listen((e=>{x.coord=x.coord.clone({scroll:e})})),x.coord=x.coord.clone({scroll:y.scroll,scale:y.scale,angle:y.angle}),y.onPenCountChange.listen((e=>{x.penCount=e})),y.onClear.listen((()=>{x.clear()})),x.listenRequestZoom((e=>{y.scale=((e,t)=>{var s;const n=t?w:[...w].reverse(),i=n.findIndex((s=>t?s>e:s<e)),o=null!=(s=n[i])?s:0;return Math.max(.2,Math.min(4,o))})(y.scale,e)}));
