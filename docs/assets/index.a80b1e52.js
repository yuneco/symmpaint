var e=Object.defineProperty,t=(t,s,n)=>(((t,s,n)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n})(t,"symbol"!=typeof s?s+"":s,n),n);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class s{constructor(e=0,s=0){t(this,"x"),t(this,"y"),this.x=e,this.y=s}equals(e){return this.x===e.x&&this.y===e.y}move(e){return new s(this.x+e.x,this.y+e.y)}rotate(e){const t=e/180*Math.PI,n=Math.cos(t),r=Math.sin(t),o=this.x*n-this.y*r,i=this.x*r+this.y*n;return new s(o,i)}scale(e){return new s(this.x*e,this.y*e)}}class n{constructor(e=new s,n=new s,r=1,o=0){t(this,"anchor"),t(this,"scroll"),t(this,"scale"),t(this,"angle"),this.anchor=e,this.scroll=n,this.scale=r,this.angle=o}}class r{constructor(e,s){t(this,"el"),t(this,"ctx"),t(this,"_coord");const r=document.createElement("canvas"),o=r.getContext("2d");if(!o)throw new Error("Failed to get 2d context for canvas");r.width=e,r.height=s,r.style.border="1px solid #aaa",o.lineCap="round",this.el=r,this.ctx=o,this._coord=new n}set coord(e){this._coord=e,this.ctx.resetTransform(),this.ctx.scale(1/e.scale,1/e.scale),this.ctx.translate(-e.anchor.x,-e.anchor.y),this.ctx.rotate(-e.angle/180*Math.PI),this.ctx.translate(e.anchor.x,e.anchor.y),this.ctx.translate(e.scroll.x,e.scroll.y)}get coord(){return this._coord}moveTo(e){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y)}drawTo(e,t=.5){const s=10*t;this.ctx.lineWidth=s,this.ctx.lineTo(e.x,e.y),this.ctx.stroke()}output(e,t){t.save();const s=this.coord;t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.translate(-s.scroll.x,-s.scroll.y),t.translate(-s.anchor.x,-s.anchor.y),t.rotate(s.angle/180*Math.PI),t.translate(s.anchor.x,s.anchor.y),t.scale(s.scale,s.scale),t.drawImage(this.el,0,0),t.strokeStyle="#aaaaaa",t.strokeRect(0,0,e.width,e.height),t.restore()}}class o{constructor(){t(this,"listeners",[])}fire(e){this.listeners.forEach((t=>t(e)))}listen(e){this.listeners.includes(e)||this.listeners.push(e)}}class i{constructor(e,s=0,n=100,r=0){t(this,"elOuter"),t(this,"elSlider");const o=this.elOuter=document.createElement("div"),i=this.elSlider=document.createElement("input"),l=document.createElement("label"),a=document.createElement("span"),c=document.createElement("span");o.appendChild(l),l.appendChild(a),l.appendChild(c),l.appendChild(i),i.type="range",i.min=String(s),i.max=String(n),i.value=String(r),a.textContent=`${e}: `,c.textContent=i.value,i.addEventListener("input",(()=>{c.textContent=i.value}))}get el(){return this.elOuter}get slider(){return this.elSlider}get value(){return this.slider.valueAsNumber}}const l=document.querySelector("#main"),a=document.querySelector("#palette"),c=new class{constructor(e){t(this,"_scale",0),t(this,"_angle",0),t(this,"_scrollX",0),t(this,"_scrollY",0),t(this,"onScaleChange",new o),t(this,"onAngleChange",new o),t(this,"onScrollChange",new o);const s=new i("Scale",50,300,100),n=new i("Angle",-180,180,0),r=new i("Scroll X",-400,400,0),l=new i("Scroll Y",-400,400,0);e.appendChild(s.el),e.appendChild(n.el),e.appendChild(r.el),e.appendChild(l.el),this.scale=Number(s.value)/100,this.angle=Number(n.value),this.scrollX=Number(r.value),this.scrollY=Number(l.value),s.slider.addEventListener("input",(()=>{this.scale=Number(s.value)/100})),n.slider.addEventListener("input",(()=>{this.angle=Number(n.value)})),r.slider.addEventListener("input",(()=>{this.scrollX=Number(r.value)})),l.slider.addEventListener("input",(()=>{this.scrollY=Number(l.value)}))}get scale(){return this._scale}get angle(){return this._angle}get scroll(){return new s(this._scrollX,this._scrollY)}set scale(e){this.scale!==e&&(this._scale=e,this.onScaleChange.fire(e))}set angle(e){this.angle!==e&&(this._angle=e,this.onAngleChange.fire(e))}set scrollX(e){this._scrollX!==e&&(this._scrollX=e,this.onScrollChange.fire(new s(this._scrollX,this._scrollY)))}set scrollY(e){this._scrollY!==e&&(this._scrollY=e,this.onScrollChange.fire(new s(this._scrollX,this._scrollY)))}}(a),h=new class{constructor(e){t(this,"canvas"),t(this,"view"),t(this,"eventStatus",{isWatchMove:!1}),this.canvas=new r(800,800),this.view=new r(800,800),e.appendChild(this.view.el),this.registerEventHandlers()}registerEventHandlers(){const e=this.view.el;e.addEventListener("pointerdown",(e=>this.onDown(e))),e.addEventListener("pointermove",(e=>this.eventStatus.isWatchMove&&this.onMove(e))),e.addEventListener("pointerup",(e=>this.eventStatus.isWatchMove&&this.onUp(e)))}get coord(){return this.canvas.coord}set coord(e){this.canvas.coord=new n(new s(-400,-400),e.scroll,e.scale,e.angle),this.canvas.output(this.view.el,this.view.ctx)}event2canvasPoint(e){return new s(1*e.offsetX,1*e.offsetY)}onDown(e){this.eventStatus.isWatchMove=!0,this.moveTo(this.event2canvasPoint(e))}onMove(e){this.drawTo(this.event2canvasPoint(e),e.pressure)}onUp(e){this.eventStatus.isWatchMove=!1,this.drawTo(this.event2canvasPoint(e))}moveTo(e){this.canvas.moveTo(e)}drawTo(e,t=.5){this.canvas.drawTo(e,t),this.canvas.output(this.view.el,this.view.ctx)}}(l);c.onScaleChange.listen((e=>{h.coord=new n(h.coord.anchor,h.coord.scroll,e,h.coord.angle)})),c.onAngleChange.listen((e=>{h.coord=new n(h.coord.anchor,h.coord.scroll,h.coord.scale,e)})),c.onScrollChange.listen((e=>{h.coord=new n(h.coord.anchor,e,h.coord.scale,h.coord.angle)})),h.coord=new n(h.coord.anchor,c.scroll,c.scale,c.angle);
