var Pt=Object.defineProperty;var nt=Object.getOwnPropertySymbols;var bt=Object.prototype.hasOwnProperty,kt=Object.prototype.propertyIsEnumerable;var G=(e,t,n)=>t in e?Pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,B=(e,t)=>{for(var n in t||(t={}))bt.call(t,n)&&G(e,n,t[n]);if(nt)for(var n of nt(t))kt.call(t,n)&&G(e,n,t[n]);return e};var i=(e,t,n)=>(G(e,typeof t!="symbol"?t+"":t,n),n);import{d as N}from"./vendor.1c606baf.js";const Et=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};Et();class v{constructor(t=0,n=0){i(this,"x");i(this,"y");this.x=t,this.y=n}equals(t){return this.x===t.x&&this.y===t.y}move(t){return new v(this.x+t.x,this.y+t.y)}sub(t){return new v(this.x-t.x,this.y-t.y)}get angle(){return Math.atan2(this.y,this.x)/Math.PI*180}get length(){return Math.sqrt(this.x**2+this.y**2)}rotate(t){const n=t/180*Math.PI,s=Math.cos(n),o=Math.sin(n),r=this.x*s-this.y*o,a=this.x*o+this.y*s;return new v(r,a)}scale(t){return new v(this.x*t,this.y*t)}get invert(){return this.scale(-1)}}const st=e=>new v(e.x,e.y);class E{constructor(t){i(this,"scroll");i(this,"scale");i(this,"angle");i(this,"flipY");i(this,"_matrix");var n,s,o,r;this.scroll=(n=t==null?void 0:t.scroll)!=null?n:new v,this.scale=(s=t==null?void 0:t.scale)!=null?s:1,this.angle=(o=t==null?void 0:t.angle)!=null?o:0,this.flipY=(r=t==null?void 0:t.flipY)!=null?r:!1,this._matrix=new DOMMatrix().translateSelf(this.scroll.x,this.scroll.y).scaleSelf(this.scale,this.scale*(this.flipY?-1:1)).rotateSelf(this.angle)}toData(){return{scroll:this.scroll,scale:this.scale,angle:this.angle,flipY:this.flipY}}clone(t){const n=this.toData();return new E(B(B({},n),t))}get invert(){return new E({scroll:this.scroll.scale(-1),scale:1/this.scale,angle:-this.angle})}get matrix(){return this._matrix.translate(0)}get matrixScrollAfter(){return new DOMMatrix().scaleSelf(this.scale,this.scale*(this.flipY?-1:1)).rotateSelf(this.angle).translateSelf(this.scroll.x,this.scroll.y)}}class O{constructor(t,n){i(this,"el");i(this,"ctx");i(this,"width");i(this,"height");i(this,"_coord",new E);const s=document.createElement("canvas"),o=s.getContext("2d");if(!o)throw new Error("Failed to get 2d context for canvas");this.width=t,this.height=n,s.width=t,s.height=n,o.lineCap="round",this.el=s,this.ctx=o,this.coord=new E}get centor(){return new v(this.width/2,this.height/2)}set coord(t){const n=this.centor;this._coord=t,this.ctx.resetTransform(),this.ctx.translate(n.x,n.y),this.ctx.translate(t.scroll.x,t.scroll.y),this.ctx.rotate(-t.angle/180*Math.PI),this.ctx.scale(1/t.scale,1/t.scale)}get coord(){return this._coord}output(t,n){const s=this.centor;t.save();const o=this.coord;t.resetTransform(),t.translate(s.x,s.y),t.scale(o.scale,o.scale),t.rotate(o.angle/180*Math.PI),t.translate(-o.scroll.x,-o.scroll.y),t.translate(-s.x,-s.y),this.transferImageTo(t,n),t.restore()}copy(t,n){t.save(),t.resetTransform(),this.transferImageTo(t,n),t.restore()}transferImageTo(t,n){var s,o;this.el.width===0||this.el.height===0||(t.globalAlpha=(s=n==null?void 0:n.alpha)!=null?s:1,t.globalCompositeOperation=(o=n==null?void 0:n.composition)!=null?o:"source-over",(n==null?void 0:n.background)&&(t.fillStyle=n.background,t.fillRect(0,0,this.width,this.height)),t.drawImage(this.el,0,0))}}class P{constructor(){i(this,"listeners",[])}fire(t){this.listeners.forEach(n=>n(t))}listen(t){this.listeners.includes(t)||this.listeners.push(t)}clear(){this.listeners.length=0}}const ot=e=>{const t=e>=0?e%360:360+e%360;return t<=180?t:-360+t},At=e=>e/180*Math.PI,D=e=>{e.ctx.save(),e.ctx.resetTransform(),e.ctx.clearRect(0,0,e.width,e.height),e.ctx.restore()},Tt=(e,t)=>{e.ctx.save(),e.ctx.resetTransform(),e.ctx.fillStyle=t,e.ctx.fillRect(0,0,e.width,e.height),e.ctx.restore()},rt=(e,t,n,s,o="#91bccc",r=!1)=>{const a=o,l=`${o}88`,C=new v(e.width/2,e.height/2).move(s.scroll),w=Math.sqrt(e.width**2+e.height**2),k=w*.15;e.ctx.save(),e.ctx.resetTransform(),e.ctx.translate(C.x,C.y),e.ctx.rotate(At(s.angle)),e.ctx.lineWidth=1;for(let S=0;S<t;S++){const A=n&&S%2!=0,g=S===0||!r?w:k;e.ctx.strokeStyle=A?l:a,e.ctx.setLineDash(A?[4,4]:[]),e.ctx.beginPath(),e.ctx.moveTo(0,0),e.ctx.lineTo(0,g),e.ctx.stroke(),e.ctx.closePath(),e.ctx.rotate(360/t/180*Math.PI)}e.ctx.restore()},Lt=e=>Math.max(.1,1-Math.pow(1-e,2)),Mt=e=>{const[t,...n]=e,s=`M${t.x}, ${t.y} L`+n.map(r=>isNaN(r.x+r.y)?"":`${r.x}, ${r.y}`).join(" ")+"";return new Path2D(s)},it=e=>{if(e.length<=2)return[e];for(let t=2;t<e.length;t++){const n=e[t-2],s=e[t-1],o=e[t-0],r=s.point.sub(n.point).angle,a=o.point.sub(s.point).angle,l=Math.abs(r-a);if(Math.abs(l-180)<30)return[e.slice(0,t),...it(e.slice(t-1))]}return[e]},It=(e,t)=>{const n=e.map(r=>({x:r.point.x,y:r.point.y,w:Math.max(1,Lt(r.pressure)*t)})),s=N.exports.smooth(n,3),o=[];for(let r=0;r<s.length;r+=1){const{left:a,right:l}=N.exports.computeSidePoints(s[r],s[r-1]||s[r+1]),c=o.slice(r)[0];let C=!1;if(c){const w=N.exports.vector2.length(c,a),k=N.exports.vector2.length(c,l);C=w-k>0}c&&C?o.splice(r,0,a,l):o.splice(r,0,l,a)}return Mt(o)},lt=(e,t,n)=>{const o=t.flatMap(it).map(r=>It(r,e.lineWidth));n.forEach(r=>{o.forEach(a=>{const l=new Path2D;l.addPath(a,r),e.fill(l)})})};class K{constructor(){i(this,"_coord",new E);i(this,"children",[])}get coord(){return this._coord}set coord(t){this._coord=this._coord.clone(t)}get childCount(){return this.children.length}get state(){return{coord:this.coord,children:this.children.map(t=>t.state)}}set state(t){for(this.coord=t.coord,this.children.length>t.children.length&&(this.children.length=t.children.length);this.children.length<t.children.length;)this.addChildPen();t.children.forEach((n,s)=>{this.children[s].state=n})}get leafs(){return this.childCount?this.children.flatMap(t=>t.leafs):[this]}clone(){const t=new K;return t.state=this.state,t}childAt(t){return this.children[t]}matrices(t){const n=t.multiply(this.coord.matrix);return this.childCount?this.children.flatMap(s=>s.matrices(n)):[n]}matricesBasedFirstPen(t){const n=this.matrices(t),s=n[0].inverse();return n.map(o=>o.multiply(s))}addChildPen(t){const n=new K;return t&&(n.coord=t),this.children.push(n),n}clearChildren(){this.children.length=0}drawStrokes(t,n){const s=this.matricesBasedFirstPen(new DOMMatrix);lt(t.ctx,n,s)}drawLines(t,n,s=.5){if(n.length<2)return;const o=t.ctx,r=n.map(l=>({point:l,pressure:s})),a=this.matricesBasedFirstPen(new DOMMatrix);lt(o,[r],a)}dryRun(t){const n=this.matrices(new DOMMatrix),s=n[0].inverse();return n.map(o=>t.map(r=>{const a=s.transformPoint(r.point);return{point:st(o.transformPoint(a)),pressure:r.pressure}}))}}class j{constructor(t){i(this,"color");i(this,"penSize");i(this,"alpha");i(this,"composition");var n,s,o,r;this.color=(n=t==null?void 0:t.color)!=null?n:"#000000",this.penSize=(s=t==null?void 0:t.penSize)!=null?s:10,this.alpha=(o=t==null?void 0:t.alpha)!=null?o:1,this.composition=(r=t==null?void 0:t.composition)!=null?r:""}toData(){return{color:this.color,penSize:this.penSize,alpha:this.alpha,composition:this.composition}}clone(t){return new j(B(B({},this.toData()),t))}}const Dt=e=>{var t;return(t={draw:"crosshair",scroll:"move","scroll:anchor":"move",zoomup:"zoom-in",zoomdown:"zoom-out",rotate:"grab","rotate:anchor":"grab","draw:line":"crosshair","draw:stamp":"crosshair"}[e])!=null?t:"default"},Rt=(e,t)=>{const n=e.getBoundingClientRect();return new v(n.left,n.top).move(t!=null?t:new v(n.width/2,n.height/2))},qt=(e,t,n)=>{const s=t.sub(e).angle;return n.sub(e).angle-s},at=(e,t,n)=>({distance:n.sub(t),angle:qt(e,t,n)}),Kt=(e,t,n,s,o,r=1,a=60)=>{const l={startPoint:new v,lastRawPoint:new v,isWatchMove:!1,lastMs:Date.now()},c=()=>Rt(e,o==null?void 0:o()),C=g=>{!g.isPrimary||(l.startPoint=l.lastRawPoint=new v(g.clientX,g.clientY),l.isWatchMove=t(g))},w=g=>{if(!g.isPrimary||!l.isWatchMove)return;const b=new v(g.clientX,g.clientY),m=b.sub(l.lastRawPoint).length,T=Date.now(),q=1e3/(T-l.lastMs);m<r||q>a||m/r*(a/q)<3||(n(g,at(c(),l.startPoint,b)),l.lastRawPoint=b,l.lastMs=T)},k=(g,b=!0)=>{if(!g.isPrimary||!l.isWatchMove)return;const m=new v(g.clientX,g.clientY);s(g,at(c(),l.startPoint,m),b),l.isWatchMove=!1},S=g=>{k(g,!1)};return e.addEventListener("pointerdown",C),e.addEventListener("pointermove",w),e.addEventListener("pointerup",k),e.addEventListener("pointercancel",S),()=>{e.removeEventListener("pointerdown",C),e.removeEventListener("pointermove",w),e.removeEventListener("pointerup",k),e.removeEventListener("pointercancel",S)}},Wt=200,_t=300,Ot=10,ct=e=>{const[t,n]=e,s=new v((t.x+n.x)/2,(t.y+n.y)/2),o=t.sub(s).angle,r=n.sub(t).length;return{center:s,angle:o,dist:r}},Bt=e=>{const[t,n]=e;return{scroll:n.center.sub(t.center),angle:ot(n.angle-t.angle),scale:n.dist/t.dist,center:n.center}},V=e=>{const t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t},Ft=(e,t,n=1)=>{let s=[],o,r=0,a=!1,l=0,c=0;const C=()=>{r=Date.now(),a=!1,l=0,c=0},w=()=>Date.now()-r<=Wt,k=()=>{if(!(s.length<2))return[s[0].pagePoint,s[1].pagePoint]},S=h=>{const u=V(h).map(d=>d.identifier);s=s.filter(d=>!u.includes(d.identifier))},A=h=>{S(h);const u=V(h).map(d=>({identifier:d.identifier,pagePoint:new v(d.clientX,d.clientY)}));s=[...s,...u]},g=h=>{const u=V(h);let d=!1;return u.forEach(f=>{const x=s.find(I=>I.identifier===f.identifier);if(!x)return;const M=new v(f.clientX,f.clientY);x.pagePoint.sub(M).length<=n||(x.pagePoint=M,d=!0)}),d},b=h=>{var d;const u=s.length;A(h.changedTouches),u===0&&C(),u<=1&&s.length>=2&&w()&&(a=!0,o=k(),(d=t.onStart)==null||d.call(t)),l=Math.max(l,s.length)},m=h=>{var u,d,f;S(h.changedTouches),s.length<=1&&a&&(a=!1,o=void 0,(u=t.onEnd)==null||u.call(t),Date.now()-r<_t&&c<=Ot&&(l===2&&((d=t.onTwoFingerTap)==null||d.call(t)),l===3&&((f=t.onThreeFingerTap)==null||f.call(t))))},T=h=>{var f;if(!a||!g(h.changedTouches))return;const d=k();if(o&&d){const[x,M]=[ct(o),ct(d)],I=Bt([x,M]);c=Math.max(c,I.scroll.length),(f=t.onTransform)==null||f.call(t,I,l)}};return e.addEventListener("touchstart",b),e.addEventListener("touchend",m),e.addEventListener("touchcancel",m),e.addEventListener("touchmove",T),()=>{e.removeEventListener("touchstart",b),e.removeEventListener("touchend",m),e.removeEventListener("touchcancel",m),e.removeEventListener("touchmove",T)}},Y=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0};class Nt{constructor(t){i(this,"target");i(this,"_keys",{});i(this,"_removeEvents");i(this,"onChange",new P);this.target=t!=null?t:document.body;const n=o=>{const r=o.key;this._keys[r]=!0,this.onChange.fire({key:r,isDown:!0})},s=o=>{const r=o.key;delete this._keys[r],this.onChange.fire({key:r,isDown:!1})};this.target.addEventListener("keydown",n),this.target.addEventListener("keyup",s),this._removeEvents=()=>{this.target.removeEventListener("keydown",n),this.target.removeEventListener("keyup",s)}}listen(...t){this.onChange.listen(...t)}destroy(){this._removeEvents(),this.onChange.clear()}key(t){return!!this._keys[t]}get keys(){return Object.keys(this._keys)}}const Yt=e=>{const t=e.includes(" "),n=e.includes("Alt"),s=e.includes("Meta"),o=e.includes("Shift");return t&&s&&n?"zoomdown":t&&s?"zoomup":t&&n&&o?"rotate:anchor":t&&n?"rotate":t&&o?"scroll:anchor":t?"scroll":o?"draw:line":n?"draw:stamp":"draw"};class zt{constructor(){i(this,"keyWatcher");i(this,"tool");i(this,"onChange",new P);this.keyWatcher=new Nt,this.keyWatcher.listen(()=>{const t=Yt(this.keyWatcher.keys);this.tool!==t&&(this.tool=t,this.onChange.fire(t))})}listenChange(...t){this.onChange.listen(...t)}}const ht=.2,ut=4,dt=[0,ht,.33,.5,.67,.75,1,1.5,2,2.5,3,3.5,ut,1/0],pt=(e,t)=>{var r;const n=t?dt:[...dt].reverse(),s=n.findIndex(a=>t?a>e:a<e),o=(r=n[s])!=null?r:0;return Math.max(ht,Math.min(ut,o))},Xt=e=>{if(!e.length)return 0;const t=Math.floor(e.length*.9);return e[t].pressure},Ut=e=>{if(e.length===0)return[];const t=[];let n=[e[0]],s=e[0].pressure!==0;for(let o=1;o<e.length;o++){const r=e[o];if(s&&r.pressure===0){n.push(r),t.push(n),n=[r],s=!1;continue}if(!s&&r.pressure===0){n=[r],s=!1;continue}n.push(r),s=!0}return s&&t.push(n),t},gt=(e,t)=>{e.ctx.save(),e.ctx.fillStyle=t.style.color,e.ctx.lineWidth=t.style.penSize;const n=new K;n.state=t.penState,n.drawStrokes(e,Ut(t.inputs)),e.ctx.restore()},Ht=e=>{D(e)},$t=(e,t,n)=>{n.forEach(s=>{s.tool==="pen"&&(D(t),gt(t,s),t.copy(e.ctx,{alpha:s.style.alpha,composition:s.style.composition})),s.tool==="clearAll"&&Ht(e)}),D(t)},Zt=e=>e.flatMap(t=>{if(!t.length)return t;const n=t[0],s=t[t.length-1];return[{point:n.point,pressure:0},...t,{point:s.point,pressure:0}]});class z{constructor(t,n,s,o="pen"){i(this,"inputs",[]);i(this,"penState");i(this,"style");i(this,"canvasCoord");i(this,"tool");this.canvasCoord=t,this.penState=n,this.style=s,this.tool=o}addPoint(t,n){this.inputs.push({point:t,pressure:n})}clearPoints(t=!1,n=!1){const s=t?this.inputs.shift():void 0,o=n?this.inputs.pop():void 0;this.inputs.length=0,s&&this.inputs.push(s),o&&this.inputs.push(o)}get flatten(){const t=new K;t.state=this.penState;const n=t.dryRun(this.inputs),s=st(this.canvasCoord.matrixScrollAfter.transformPoint(t.coord.scroll)).invert,o=Zt(n).map(a=>({point:a.point.move(s),pressure:a.pressure}));t.clearChildren(),t.coord=new E;const r=new z(this.canvasCoord,t.state,this.style,this.tool);return r.inputs.push(...o),r}}const Gt=(e,t)=>{let n=!0;const s={activeEvent:void 0,startCoord:new E,startAnchor:[new E,new E],startPoint:new v,lastPoint:new v,isCapturing:!1,currentStroke:void 0,pen:new K},o=new O(e.width*e.resolution,e.height*e.resolution),r=h=>new v((h.offsetX-e.width/2)*e.resolution,(h.offsetY-e.height/2)*e.resolution),a=h=>{const u=e.tool;s.activeEvent=u,s.startCoord=e.coord,s.startAnchor=[e.anchor,e.childAnchor],s.lastPoint=s.startPoint=r(h),s.isCapturing=e.enableCapture&&h.metaKey,s.pen=e.canvasPen,s.currentStroke=void 0},l=h=>{if(!n)return!1;const u=e.tool;if(a(h),u==="zoomup"||u==="zoomdown"){const d=e.coord.scale;return u==="zoomup"&&t.onZoom(pt(d,!0)),u==="zoomdown"&&t.onZoom(pt(d,!1)),!1}return(u==="draw"||u==="draw:line"||u==="draw:stamp")&&w(s.startPoint),!0},c=(h,u)=>{if(!n)return;const d=s.activeEvent,f={point:r(h),pressure:h.pressure};if((d==="draw"||d==="draw:line")&&(D(o),k(f.point,f.pressure||.5)),d==="draw:stamp"&&e.stamp){const x=f.point.sub(s.startPoint),M=x.length/100;D(o),A(e.stamp,s.startPoint,M,x.angle,!0)}d==="scroll"&&b(u,"canvas"),d==="scroll:anchor"&&b(u,"anchor"),d==="rotate"&&m(u,"canvas"),d==="rotate:anchor"&&m(u,"anchor"),s.lastPoint=f.point,h.preventDefault()},C=(h,u,d=!1)=>{var I;if(!n)return!1;if(d)return S(!1),T(),!1;const f=s.activeEvent,x={point:r(h),pressure:h.pressure},M=f==="draw"||f==="draw:line"||f==="draw:stamp";if(f==="draw"&&k(x.point,h.pressure||0),f==="draw:line"){D(o);const L=s.currentStroke,W=L?Xt(L.inputs):.5;if(k(x.point,W),L){const F=L.inputs[L.inputs.length-1];L.inputs.length=1,L.inputs[0].pressure=W,L.inputs.push(F,F)}}if(f==="draw:stamp"&&e.stamp){D(o);const L=x.point.sub(s.startPoint),W=L.length/100;A(e.stamp,s.startPoint,W,L.angle,!1)}return(f==="draw"||f==="draw:line")&&s.isCapturing?(e.stamp=(I=s.currentStroke)==null?void 0:I.flatten,S(!1),T(),!1):(f==="scroll"&&b(u,"canvas"),f==="scroll:anchor"&&b(u,"anchor"),f==="rotate"&&m(u,"canvas"),f==="rotate:anchor"&&m(u,"anchor"),S(M),!0)},w=h=>{const u=e.view2canvasPos(h,"start");o.coord=new E,o.ctx.lineWidth=e.style.penSize;const d=()=>s.isCapturing?"#0044aa":e.penKind==="eraser"?e.backgroundColor:e.style.color;o.ctx.fillStyle=d(),s.currentStroke=e.startHistory(),s.currentStroke.addPoint(u,0)},k=(h,u=.5)=>{const d=s.activeEvent,f=e.view2canvasPos(h,"start"),x=s.currentStroke;if(!!x){if(x.addPoint(f,u),d==="draw:line"){const M={point:x.inputs[0].point,pressure:u},I=x.inputs[x.inputs.length-1],L=[M,I,I];s.pen.drawStrokes(o,[L])}else s.pen.drawStrokes(o,[x.inputs]);T()}},S=h=>{e.endHistory(h,o),D(o),s.activeEvent=void 0},A=(h,u,d,f,x)=>{const M=new K;M.state=s.pen.state;const I=e.style.clone({color:e.penKind==="eraser"?e.backgroundColor:e.style.color}),L=u,W=new z(e.coord,M.state,x?I:e.style,h.tool),F=h.inputs.map(et=>({point:et.point.scale(d).rotate(f).move(L),pressure:et.pressure}));W.inputs.push(...F),gt(o,W),T();const Z=s.currentStroke;!x&&Z&&(Z.clearPoints(),Z.inputs.push(...W.inputs))},g=()=>{S(!1)},b=(h,u)=>{const d=e.hasSubPen?1:0,x={canvas:s.startCoord,anchor:s.startAnchor[d]}[u].scroll.move(h.distance.scale(-1/e.coord.scale*e.resolution).rotate(-e.coord.angle).scale(u==="anchor"?-1:1));t.onScroll(x,u)},m=(h,u)=>{const d=e.hasSubPen?1:0,x={canvas:s.startCoord,anchor:s.startAnchor[d]}[u].angle+h.angle;t.onRotate(ot(x),u)},T=()=>{e.rePaint(h=>{o.ctx.save(),o.coord=e.coord,o.output(h,{alpha:e.style.alpha}),o.ctx.restore()})};return{onDown:l,onDrag:c,onUp:C,strokeState:{get enabled(){return n},set enabled(h){n=h,n||g()},get startCoord(){return s.startCoord},get startAnchor(){return s.startAnchor}}}},jt=e=>{const t=e[1].scroll.sub(e[0].scroll).angle;return new E({scroll:e[1].scroll.sub(e[0].scroll).rotate(-e[0].angle),angle:t+e[1].angle})},Vt=(e,t,n)=>{const s=new K,[o,r]=n,[a,l]=[e[0]*(o?2:1),e[1]*(r?2:1)],c=360/a/2,C=360/l/2,w=t[0].clone({angle:t[0].angle+c}),k=t[1],S=jt([w,k]);s.coord=w;for(let A=0;A<a;A++){const g=o&&A%2!=0,b=s.addChildPen(new E({angle:A/a*360,flipY:g}));for(let m=0;m<l;m++){const T=r&&m%2!=0;b.addChildPen(new E({scroll:S.scroll,angle:S.angle+(C-c)-t[0].angle})).addChildPen(new E({angle:m/l*360,flipY:T}))}}return s},Jt=(e,t,n,s,o,r)=>{const[a,l]=[o[0]>=2,o[1]>=2],[c,C]=s,[w,k]=[o[0]*(c?2:1),o[1]*(C?2:1)],[S,A]=n,g=A.scroll.sub(S.scroll).angle,b=o[0]%2?360/w/2:0,m=t.angle+n[0].angle+b;a&&rt(e,w,s[0],new E({scroll:t.scroll.invert.move(n[0].scroll).scale(t.scale).rotate(t.angle),angle:m}),l?"#cccccc":r[0]),l&&rt(e,k,s[1],new E({scroll:t.scroll.invert.move(n[1].scroll).scale(t.scale).rotate(t.angle),angle:t.angle+g+n[1].angle+90}),r[1],!0)},ft=e=>e!=null,J=(e,t)=>{var n;for(let s=t!=null?t:e.currentIndex;s>=0;s--)if((n=e.stack[s])==null?void 0:n.snapshot)return s},Qt=(e,t)=>{const n=J(e,t);if(n!==void 0)return e.stack[n].snapshot},te=(e,t,n)=>{const s=n!=null?n:e.currentIndex,o=J(e,s);if(o===void 0){console.warn("Failed to draw history: no snapshot for index",s);return}const r=e.stack[o].snapshot;r&&(t.ctx.save(),t.ctx.resetTransform(),t.ctx.drawImage(r.el,0,0),t.ctx.restore());const a=e.stack.slice(o+1,s+1).map(c=>c.stroke),l=new O(t.width,t.height);$t(t,l,a),t.ctx.restore()},ee=e=>{const t=e.stack.findIndex(n=>!!n.snapshot);return t!==-1?t:void 0},vt=e=>{const t=ee(e);return t!==void 0&&t<e.currentIndex},Ct=e=>e.currentIndex<e.stack.length-1,ne=e=>e.stack.slice(e.currentIndex+1),se=e=>vt(e)?{currentIndex:e.currentIndex-1,stack:[...e.stack]}:(console.log("no back history"),e),oe=e=>Ct(e)?{currentIndex:e.currentIndex+1,stack:[...e.stack]}:(console.log("no forward history"),e),Q="#debug .history .snaps",re=()=>{const e=document.querySelector(Q);e&&(e.innerHTML="")},ie=e=>{const t=document.querySelector(Q);if(t){const n=120/Math.max(e.width,e.height);e.style.width=`${e.width*n}px`,e.style.height=`${e.height*n}px`,t.appendChild(e),e.scrollIntoView()}},le=e=>{const t=document.querySelector(Q);t&&t.removeChild(e)},ae=(e,t,n,s=10,o=10)=>{const r=[...e.stack];r.length=e.currentIndex+1,r.push({stroke:t,id:r.length});const a={stack:r,currentIndex:r.length-1},l=J(a);(l===void 0||a.currentIndex-l>=o)&&(a.stack[a.currentIndex].snapshot=n());const c=a.stack.map((C,w)=>C.snapshot?w:void 0).filter(ft);return c.length>s&&(c.length=c.length-s,c.forEach(C=>a.stack[C].snapshot=void 0)),a},ce=10,he=10,ue=e=>{const t=new O(e.width,e.height);return e.copy(t.ctx),ie(t.el),t};class wt{constructor(t){i(this,"state",{stack:[],currentIndex:-1});i(this,"currentStroke");re(),t&&(this.start(t.canvasCoord,t.penState,t.style,t.tool),this.commit(new O(1,1)))}get strokes(){return this.state.stack[this.state.currentIndex]}get snapshot(){return Qt(this.state)}get current(){return this.currentStroke}get undoable(){return vt(this.state)}get redoable(){return Ct(this.state)}start(t,n,s,o){const r=new z(t,n,s,o);return this.currentStroke=r,r}commit(t){if(!this.currentStroke)return;ne(this.state).map(s=>{var o;return(o=s.snapshot)==null?void 0:o.el}).filter(ft).forEach(le),this.state=ae(this.state,this.currentStroke,()=>ue(t),he,ce),this.currentStroke=void 0}rollback(){!this.currentStroke||(this.currentStroke=void 0)}undo(){return this.undoable?(this.state=se(this.state),!0):!1}redo(){return this.redoable?(this.state=oe(this.state),!0):!1}draw(t){te(this.state,t,this.state.currentIndex)}}const R=2,mt=3.5,de={normal:"",eraser:"destination-out"};class pe{constructor(t,n,s){i(this,"width");i(this,"height");i(this,"resolution",R);i(this,"canvas");i(this,"view");i(this,"history");i(this,"strokeState");i(this,"events",{requestChangeZoom:new P,requestScrollTo:new P,requestRotateTo:new P,requestUndo:new P,requestAnchorTransform:new P,requestAnchorReset:new P,strokeStart:new P,strokeEnd:new P});i(this,"setting",{style:new j,stamp:void 0,tool:"draw",backgroundColor:"#ffffff",anchor:[new E,new E],penCount:[1,0],isKaleido:[!1,!1],anchorColor:["#91bccc","#eeaabb"],enableCapure:!0});i(this,"pen",new K);i(this,"view2canvasPos",(t,n)=>{const s=n==="start"?this.strokeState.startCoord:this.coord;return t.scale(1/s.scale).rotate(-s.angle).move(s.scroll)});i(this,"canvas2viewPos",(t,n)=>{const s=n==="start"?this.strokeState.startCoord:this.coord;return t.move(s.scroll.invert).rotate(s.angle).scale(s.scale)});i(this,"canvas2displayPos",(t,n)=>this.canvas2viewPos(t,n).move(new v(this.width,this.height)).scale(1/R));i(this,"display2canvasPos",(t,n)=>this.canvas2viewPos(t.scale(R).move(new v(-this.width,-this.height)),n));i(this,"rePaintRequestId",0);var a;this.width=n,this.height=s,this.canvas=new O(this.width*R,this.height*R),this.view=new O(this.width*R,this.height*R),this.history=new wt({canvasCoord:this.coord,penState:this.pen.state,style:this.setting.style}),this.view.el.style.width=`${n}px`,this.view.el.style.height=`${s}px`,t.appendChild(this.view.el);const o=document.getElementById("debug");if(o){const l=200/Math.max(n,s);this.canvas.el.style.width=`${n*l}px`,this.canvas.el.style.height=`${s*l}px`,(a=o.querySelector(".canvas"))==null||a.appendChild(this.canvas.el)}const r=Gt(this,{onScroll:(l,c)=>this.events.requestScrollTo.fire({point:l,target:c}),onRotate:(l,c)=>this.events.requestRotateTo.fire({angle:l,target:c}),onZoom:l=>this.events.requestChangeZoom.fire(l)});this.strokeState=r.strokeState,Ft(this.view.el,{onStart:()=>{this.strokeState.enabled=!1},onTransform:(l,c)=>c>=3?this.onTouchTramsformAnchor(l):this.onTouchTramsformCanvas(l),onEnd:()=>{this.strokeState.enabled=!0},onTwoFingerTap:()=>this.events.requestUndo.fire(),onThreeFingerTap:()=>this.events.requestAnchorReset.fire()},mt),Kt(this.view.el,l=>{const c=r.onDown(l);return c&&this.events.strokeStart.fire(),c},(l,c)=>r.onDrag(l,c),(l,c,C)=>{const w=r.onUp(l,c,!C);this.events.strokeEnd.fire(w)},()=>this.tool==="scroll:anchor"||this.tool==="rotate:anchor"?this.canvas2displayPos(this.activeAnchor.scroll,"start"):void 0,mt),this.childAnchor=new E({scroll:new v(300,-70),angle:0}),this.tool="draw",D(this.canvas)}get canvasPen(){return this.pen.clone()}get coord(){return this.canvas.coord}set coord(t){this.canvas.coord=t,this.rePaint()}get tool(){return this.setting.tool}set tool(t){this.setting.tool=t,this.view.el.style.cursor=Dt(t)}get isKaleido(){return[...this.setting.isKaleido]}set isKaleido(t){Y(this.isKaleido,t)||(this.setting.isKaleido=[...t],this.rebuildPen(),this.rePaint())}get penCount(){return this.setting.penCount}set penCount(t){Y(this.penCount,t)||(this.setting.penCount=[...t],this.rebuildPen(),this.rePaint())}get hasSubPen(){return this.penCount[1]>=1}set penWidth(t){this.setting.style=this.setting.style.clone({penSize:t})}set penColor(t){this.setting.style=this.setting.style.clone({color:t})}set penAlpha(t){this.setting.style=this.setting.style.clone({alpha:t})}get penKind(){return this.setting.style.composition===""?"normal":"eraser"}set penKind(t){this.setting.style=this.setting.style.clone({composition:de[t]})}get stamp(){return this.setting.stamp}set stamp(t){this.setting.stamp=t}get backgroundColor(){return this.setting.backgroundColor}set backgroundColor(t){this.setting.backgroundColor!==t&&(this.setting.backgroundColor=t,this.rePaint())}get anchor(){return this.setting.anchor[0]}set anchor(t){this.setting.anchor[0]=t,this.rebuildPen(),this.rePaint()}get childAnchor(){return this.setting.anchor[1]}set childAnchor(t){this.setting.anchor[1]=t,this.rebuildPen(),this.rePaint()}get activeAnchor(){return this.hasSubPen?this.childAnchor:this.anchor}set activeAnchor(t){this[this.hasSubPen?"childAnchor":"anchor"]=t}get style(){return this.setting.style}get anchorColor(){return[...this.setting.anchorColor]}set anchorColor(t){this.setting.anchorColor=[...t]}get enableCapture(){return this.setting.enableCapure}set enableCapture(t){this.setting.enableCapure=t}get enableUndo(){return this.history.undoable}get enableRedo(){return this.history.redoable}rebuildPen(){this.pen.state=Vt(this.setting.penCount,this.setting.anchor,this.setting.isKaleido).state}listenRequestZoom(t){this.events.requestChangeZoom.listen(t)}listenRequestScrollTo(t){this.events.requestScrollTo.listen(t)}listenRequestRotateTo(t){this.events.requestRotateTo.listen(t)}listenRequestUndo(t){this.events.requestUndo.listen(t)}listenRequestAnchorTransform(t){this.events.requestAnchorTransform.listen(t)}listenRequestAnchorReset(t){this.events.requestAnchorReset.listen(t)}listenStrokeStart(t){this.events.strokeStart.listen(t)}listenStrokeEnd(t){this.events.strokeEnd.listen(t)}clear(t){t?this.history=new wt({canvasCoord:this.coord,penState:this.pen.state,style:this.setting.style}):(this.history.start(this.coord,this.pen.state,this.setting.style,"clearAll"),this.history.commit(this.canvas)),D(this.canvas),this.rePaint()}undo(){!this.history.undoable||(D(this.canvas),this.history.undo(),this.history.draw(this.canvas),this.rePaint())}redo(){!this.history.redoable||(D(this.canvas),this.history.redo(),this.history.draw(this.canvas),this.rePaint())}startHistory(){return this.history.start(this.coord,this.pen.state,this.setting.style)}endHistory(t,n){if(!t){this.history.rollback();return}n==null||n.copy(this.canvas.ctx,{alpha:this.setting.style.alpha,composition:this.setting.style.composition}),this.history.commit(this.canvas),this.rePaint()}async toImgBlob(){return new Promise((t,n)=>{this.canvas.el.toBlob(s=>s?t(s):n())})}onTouchTramsformCanvas(t){const n=this.strokeState.startCoord,{center:s,scroll:o,scale:r,angle:a}=t,l=T=>T.rotate(-n.angle).scale(1/n.scale),c=new v((s.x-this.width/2)*R,(s.y-this.height/2)*R),C=this.view2canvasPos(c,"start"),w=new v(0,0),k=this.view2canvasPos(w,"start"),S=C.sub(k),g=S.rotate(-a).scale(1/r).sub(S),b=o.scale(R),m=l(b);this.events.requestRotateTo.fire({angle:n.angle+a,target:"canvas"}),this.events.requestChangeZoom.fire(n.scale*r),this.events.requestScrollTo.fire({point:n.scroll.sub(g).sub(m),target:"canvas"})}onTouchTramsformAnchor(t){const n=this.strokeState.startAnchor[this.hasSubPen?1:0],s=t.angle+n.angle,o=t.scroll.scale(1/this.strokeState.startCoord.scale*R).rotate(-this.strokeState.startCoord.angle).move(n.scroll);this.events.requestAnchorTransform.fire(n.clone({scroll:o,angle:s}))}rePaint(t){cancelAnimationFrame(this.rePaintRequestId),this.rePaintRequestId=requestAnimationFrame(()=>{this.rePaintRequestId=0,Tt(this.view,"#cccccc"),this.canvas.output(this.view.ctx,{background:this.backgroundColor}),t==null||t(this.view.ctx),Jt(this.view,this.coord,this.setting.anchor,this.isKaleido,this.penCount,this.setting.anchorColor)})}}class X{constructor(t){i(this,"el");const n=this.el=document.createElement("button");n.className="Button",n.textContent=t}addEventListener(...t){return this.el.addEventListener(...t)}removeEventListener(...t){return this.el.removeEventListener(...t)}}class _{constructor(t,n=0,s=100,o=0,r=!1){i(this,"el");i(this,"elSlider");i(this,"elText");i(this,"isPercent");const a=this.el=document.createElement("div"),l=this.elSlider=document.createElement("input"),c=document.createElement("label"),C=document.createElement("span"),w=this.elText=document.createElement("span");this.isPercent=r,a.appendChild(c),c.appendChild(C),c.appendChild(w),c.appendChild(l),l.type="range",l.className="Slider",l.min=String(n),l.max=String(s),l.value=String(o),C.textContent=`${t}: `,w.textContent=l.value,l.addEventListener("input",()=>{w.textContent=l.value})}get value(){return this.elSlider.valueAsNumber*(this.isPercent?.01:1)}set value(t){const n=t*(this.isPercent?100:1);this.elSlider.value=String(n),this.elText.textContent=String(n)}addEventListener(...t){return this.elSlider.addEventListener(...t)}removeEventListener(...t){return this.elSlider.removeEventListener(...t)}}class U{constructor(t,n=!1){i(this,"el");i(this,"elCheck");const s=this.el=document.createElement("div"),o=this.elCheck=document.createElement("input"),r=document.createElement("label"),a=document.createElement("span");s.appendChild(r),r.appendChild(o),r.appendChild(a),s.className="Checkbox",o.type="checkbox",o.checked=n,a.textContent=t}get value(){return this.elCheck.checked}set value(t){this.elCheck.checked=t}addEventListener(...t){return this.elCheck.addEventListener(...t)}removeEventListener(...t){return this.elCheck.removeEventListener(...t)}}class yt{constructor(t,n=!1){i(this,"el");i(this,"elColor");const s=this.el=document.createElement("div"),o=this.elColor=document.createElement("input"),r=document.createElement("label"),a=document.createElement("span");s.appendChild(r),r.appendChild(o),r.appendChild(a),s.className="ColorSelector",o.type="color",o.checked=n,a.textContent=t}get value(){return this.elColor.value}set value(t){this.elColor.value=t}addEventListener(...t){return this.elColor.addEventListener(...t)}removeEventListener(...t){return this.elColor.removeEventListener(...t)}}class ge{constructor(t,n){i(this,"checks");i(this,"_value");i(this,"el");i(this,"_updating",!1);i(this,"onChange",new P);const s=Object.keys(t);this.checks=s.map(r=>({cb:new U(t[r]),key:r})),this.value=n,this._value=n,this.checks.forEach(r=>{r.cb.addEventListener("change",()=>{this._updating||r.cb.value&&(this.value=r.key)})});const o=this.el=document.createElement("div");o.className="RadioGroup",this.checks.forEach(r=>{o.appendChild(r.cb.el)})}get value(){return this._value}set value(t){const n=this._value!==t;this._value=t,this.updateChecked(),!!n&&this.onChange.fire(t)}updateChecked(){this._updating=!0,this.checks.forEach(t=>t.cb.value=t.key===this.value),this._updating=!1}listenChange(...t){this.onChange.listen(...t)}}const fe={draw:"Draw","draw:line":"Line","draw:stamp":"Stamp",scroll:"Move","scroll:anchor":"Move Anchor",rotate:"Rotate","rotate:anchor":"Rotate Anchor",zoomup:"+",zoomdown:"-"};class ve{constructor(t,n){i(this,"slScale");i(this,"slAngle");i(this,"slX");i(this,"slY");i(this,"slPenCount1");i(this,"slPenCount2");i(this,"slPenWidth");i(this,"cbKaleido1");i(this,"cbKaleido2");i(this,"cbEraser");i(this,"csDrawingColor");i(this,"csCanvasColor");i(this,"slDrawingAlpha");i(this,"cbTools");i(this,"onScaleChange",new P);i(this,"onAngleChange",new P);i(this,"onScrollChange",new P);i(this,"onPenCountChange",new P);i(this,"onPenWidthChange",new P);i(this,"onClear",new P);i(this,"onUndo",new P);i(this,"onRedo",new P);i(this,"onCopy",new P);i(this,"onKaleidoChange",new P);i(this,"onEraserChange",new P);i(this,"onDrawingColorChange",new P);i(this,"onCanvasColorChange",new P);i(this,"onDrawingAlphaChange",new P);i(this,"onToolChange",new P);i(this,"canvasWidth");i(this,"canvasHeight");this.canvasWidth=n.height,this.canvasHeight=n.height;const s=this.slScale=new _("Scale",50,300,100,!0),o=this.slAngle=new _("Angle",-360,360,0),r=this.slX=new _("Scroll X",-this.canvasWidth/2,this.canvasWidth/2,0),a=this.slY=new _("Scroll Y",-this.canvasHeight/2,this.canvasHeight/2,0),l=this.slPenCount1=new _("Pen Count Parent",1,16,1),c=this.slPenCount2=new _("Pen Count Child",0,8,1),C=this.slPenWidth=new _("Pen Size",2,100,20),w=new X("Clear All"),k=new X("Undo"),S=new X("Redo"),A=new X("Copy Image"),g=this.cbKaleido1=new U("Kalaidoscope"),b=this.cbKaleido2=new U("Kalaidoscope"),m=this.cbEraser=new U("Eraser"),T=this.csDrawingColor=new yt("Pen Color"),q=this.csCanvasColor=new yt("BG Color"),h=this.slDrawingAlpha=new _("Pen Alpha",1,100,100,!0),u=this.cbTools=new ge(fe,"draw");t.appendChild(u.el),t.appendChild(m.el),t.appendChild(T.el),t.appendChild(q.el),t.appendChild(l.el),t.appendChild(g.el),t.appendChild(c.el),t.appendChild(b.el),t.appendChild(h.el),t.appendChild(C.el),t.appendChild(w.el),t.appendChild(k.el),t.appendChild(S.el),t.appendChild(A.el),s.addEventListener("input",()=>{this.onScaleChange.fire(s.value)}),o.addEventListener("input",()=>{this.onAngleChange.fire(o.value)}),r.addEventListener("input",()=>{this.onScrollChange.fire(new v(r.value,a.value))}),a.addEventListener("input",()=>{this.onScrollChange.fire(new v(r.value,a.value))}),l.addEventListener("input",()=>{this.onPenCountChange.fire([l.value,c.value])}),c.addEventListener("input",()=>{this.onPenCountChange.fire([l.value,c.value])}),C.addEventListener("input",()=>{this.onPenWidthChange.fire(C.value)}),w.addEventListener("click",()=>{this.onClear.fire()}),k.addEventListener("click",()=>{this.onUndo.fire()}),S.addEventListener("click",()=>{this.onRedo.fire()}),A.addEventListener("click",()=>{this.onCopy.fire()}),g.addEventListener("change",()=>{this.onKaleidoChange.fire([g.value,b.value])}),b.addEventListener("change",()=>{this.onKaleidoChange.fire([g.value,b.value])}),m.addEventListener("change",()=>{this.onEraserChange.fire(m.value)}),T.addEventListener("input",()=>{this.onDrawingColorChange.fire(T.value)}),q.addEventListener("input",()=>{this.onCanvasColorChange.fire(q.value)}),h.addEventListener("input",()=>{this.onDrawingAlphaChange.fire(h.value)}),u.listenChange(d=>this.onToolChange.fire(d))}get scale(){return this.slScale.value}get angle(){return this.slAngle.value}get scroll(){return new v(this.slX.value,this.slY.value)}get penCount(){return[this.slPenCount1.value,this.slPenCount2.value]}get penWidth(){return this.slPenWidth.value}get kaleidoscope(){return[this.cbKaleido1.value,this.cbKaleido2.value]}get drawingColor(){return this.csDrawingColor.value}get canvasColor(){return this.csCanvasColor.value}get drawingAlpha(){return this.slDrawingAlpha.value}get tool(){return this.cbTools.value}get eraser(){return this.cbEraser.value}set scale(t){this.scale!==t&&(this.slScale.value=t,this.onScaleChange.fire(this.slScale.value),this.updateScrollRange())}set angle(t){this.angle!==t&&(this.slAngle.value=t,this.onAngleChange.fire(this.slAngle.value))}set scrollX(t){this.slX.value!==t&&(this.slX.value=t,this.onScrollChange.fire(new v(this.slX.value,this.slY.value)))}set scrollY(t){this.slY.value!==t&&(this.slY.value=t,this.onScrollChange.fire(new v(this.slX.value,this.slY.value)))}set penCount(t){Y(this.penCount,t)||(this.slPenCount1.value=t[0],this.slPenCount2.value=t[1],this.onPenCountChange.fire([this.slPenCount1.value,this.slPenCount2.value]))}set penWidth(t){this.penWidth!==t&&(this.slPenWidth.value=t,this.onPenWidthChange.fire(this.slPenWidth.value))}set kaleidoscope(t){Y(this.kaleidoscope,t)||(this.cbKaleido1.value=t[0],this.cbKaleido2.value=t[1],this.onKaleidoChange.fire([this.cbKaleido1.value,this.cbKaleido2.value]))}set drawingColor(t){this.drawingColor!==t&&(this.csDrawingColor.value=t,this.onDrawingColorChange.fire(this.csDrawingColor.value))}set canvasColor(t){this.canvasColor!==t&&(this.csCanvasColor.value=t,this.onCanvasColorChange.fire(this.csCanvasColor.value))}set drawingAlpa(t){this.drawingAlpa!==t&&(this.slDrawingAlpha.value=t,this.onDrawingAlphaChange.fire(this.slDrawingAlpha.value))}set tool(t){this.cbTools.value=t}set eraser(t){this.cbEraser.value=t}penCountUp(){const[t,n]=this.penCount;this.penCount=[t+1,n]}penCountDown(){const[t,n]=this.penCount;t<=1||(this.penCount=[t-1,n])}updateScrollRange(){const t=this.canvasWidth/2*this.scale,n=this.canvasHeight/2*this.scale;this.slX.elSlider.min=String(-t),this.slX.elSlider.max=String(t),this.slY.elSlider.min=String(-n),this.slY.elSlider.max=String(n)}}const H=document.querySelector("#main"),St=document.querySelector("#palette"),tt=document.querySelector("#toast"),$=new v(H.offsetWidth,H.offsetHeight),Ce=e=>{tt.textContent=e,tt.classList.add("visible"),setTimeout(()=>{tt.classList.remove("visible")},5e3)},y=new ve(St,{width:$.x,height:$.y}),p=new pe(H,$.x,$.y);y.onScaleChange.listen(e=>{p.coord=p.coord.clone({scale:e})});y.onAngleChange.listen(e=>{p.coord=p.coord.clone({angle:e})});y.onScrollChange.listen(e=>{p.coord=p.coord.clone({scroll:e})});y.onPenCountChange.listen(e=>{p.penCount=e});y.onPenWidthChange.listen(e=>{p.penWidth=e});y.onClear.listen(()=>{!confirm("Are you sure you want to clear canvas? This action can not undo.")||p.clear(!0)});y.onUndo.listen(()=>{p.undo()});y.onRedo.listen(()=>{p.redo()});const we=async()=>{let e;try{e=new ClipboardItem({"image/png":p.toImgBlob()})}catch{e=new ClipboardItem({"image/png":await p.toImgBlob()})}await navigator.clipboard.write([e])};y.onCopy.listen(()=>{we().catch(e=>{console.error(e),alert("failed to copy img.")})});y.onKaleidoChange.listen(e=>{p.isKaleido=e});y.onEraserChange.listen(e=>{p.penKind=e?"eraser":"normal"});y.onDrawingColorChange.listen(e=>{p.penColor=e});y.onCanvasColorChange.listen(e=>{p.backgroundColor=e});y.onDrawingAlphaChange.listen(e=>{p.penAlpha=e});y.onToolChange.listen(e=>{if(p.tool=e,e==="draw:stamp"&&!p.stamp){const t={ja:"\u30B9\u30BF\u30F3\u30D7\u3092\u4F7F\u7528\u3059\u308B\u306B\u306F\u3001\u5148\u306BCommand(Ctrl)\u3092\u62BC\u3057\u306A\u304C\u3089\u7DDA\u3092\u5F15\u3044\u3066\u30B9\u30BF\u30F3\u30D7\u3092\u8A18\u9332\u3057\u307E\u3059",en:"Before using stamp, draw with Command(Ctrl) key for record a stroke."}[xt];Ce(t)}});p.coord=p.coord.clone({scroll:y.scroll,scale:y.scale,angle:y.angle});p.listenRequestZoom(e=>{p.coord=p.coord.clone({scale:e})});p.listenRequestScrollTo(({point:e,target:t})=>{t==="canvas"&&(p.coord=p.coord.clone({scroll:e})),t==="anchor"&&(p.activeAnchor=p.activeAnchor.clone({scroll:e}))});p.listenRequestRotateTo(({angle:e,target:t})=>{t==="canvas"&&(p.coord=p.coord.clone({angle:e})),t==="anchor"&&(p.activeAnchor=p.activeAnchor.clone({angle:e}))});p.listenRequestUndo(()=>{p.undo()});p.listenRequestAnchorTransform(e=>{p.activeAnchor=e});p.listenRequestAnchorReset(()=>{p.anchor=new E});p.listenStrokeStart(()=>{console.log("start stroke")});p.listenStrokeEnd(()=>{console.log("end stroke")});window.addEventListener("keydown",e=>{e.key==="ArrowUp"&&y.penCountUp(),e.key==="ArrowDown"&&y.penCountDown(),e.key==="z"&&e.metaKey&&(e.shiftKey?y.onRedo.fire():y.onUndo.fire()),e.key==="c"&&e.metaKey&&y.onCopy.fire()});const me=new zt;me.listenChange(e=>y.tool=e);y.kaleidoscope=[!0,!0];y.penCount=[6,6];y.canvasColor="#ffffff";H.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1});St.addEventListener("touchmove",function(e){e.touches.length>=2&&e.preventDefault()},{passive:!1});const xt=navigator.language==="ja"?"ja":"en";document.querySelectorAll(".lang").forEach(e=>e.style.display="none");document.querySelectorAll(`.lang.${xt}`).forEach(e=>e.style.display="");
